<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Liste des Collecteurs</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f5f6fa;
      margin: 0;
      color: #2f3640;
    }
    header {
      background-color: #273c75;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    header h1 {
      font-size: 1.4rem;
      margin: 0;
    }
    nav a {
      color: white;
      text-decoration: none;
      margin-left: 15px;
      font-weight: 500;
    }
    nav a.active {
      border-bottom: 2px solid #00a8ff;
    }
    main {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 {
      color: #273c75;
      border-left: 4px solid #00a8ff;
      padding-left: 10px;
      margin-bottom: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 2rem;
    }
    thead {
      background-color: #273c75;
      color: white;
    }
    th, td {
      padding: 12px 15px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }
    tr:hover {
      background-color: #f1f2f6;
    }
    .action-btn {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1rem;
      padding: 6px;
      border-radius: 6px;
      transition: 0.3s;
    }
    .action-btn.delete {
      color: #e84118;
    }
    .action-btn.delete:hover {
      background-color: #f8d7da;
    }
    .action-btn.edit {
      color: #44bd32;
    }
    .action-btn.edit:hover {
      background-color: #d4efdf;
    }
    .update-form {
      display: none;
      background-color: #f5f6fa;
      padding: 15px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #dcdde1;
    }
    .update-form input {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-right: 8px;
      font-size: 14px;
    }
    .update-form button {
      background-color: #273c75;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    .update-form button:hover {
      background-color: #40739e;
    }
    form.add-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      background-color: #f5f6fa;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #dcdde1;
    }
    form.add-form input {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }
    form.add-form button {
      align-self: flex-start;
      background-color: #44bd32;
      color: white;
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }
    form.add-form button:hover {
      background-color: #4cd137;
    }
  </style>
</head>
<body>
  <header>
    <h1>Bienvenue, <%= agent.nom %> üëã</h1>
    <nav>
      <a href="/agent/dashboard">Dashboard</a>
      <a href="/agent/collecteurs" class="active">Collecteurs</a>
    </nav>
  </header>

  <main>
    <section>
      <h2><i class="fa-solid fa-users"></i> Liste des Collecteurs</h2>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Nom</th>
            <th>Pr√©nom</th>
            <th>Email</th>
            <th>T√©l√©phone</th>
            <th>Zone</th>
            <th>N¬∞ V√©hicule</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (collecteurs && collecteurs.length > 0) { %>
            <% collecteurs.forEach(c => { %>
              <tr>
                <td><%= c.id %></td>
                <td><%= c.nom %></td>
                <td><%= c.prenom %></td>
                <td><%= c.email %></td>
                <td><%= c.tel %></td>
                <td><%= c.zone %></td>
                <td><%= c.numVehicule %></td>
                <td>
                  <button class="action-btn edit" onclick="toggleUpdateForm('<%= c.id %>')">
                    <i class="fa-solid fa-pen-to-square"></i>
                  </button>
                  <form action="/agent/collecteurs/<%= c.id %>/delete" method="POST" style="display:inline;">
                    <button class="action-btn delete" type="submit" title="Supprimer">
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </form>
                </td>
              </tr>

              <tr id="update-form-<%= c.id %>" class="update-form">
                <td colspan="8">
                  <form action="/agent/collecteurs/<%= c.id %>/update" method="POST" class="update-form">
                    <input type="text" name="nom" value="<%= c.nom %>" required>
                    <input type="text" name="prenom" value="<%= c.prenom %>" required>
                    <input type="email" name="email" value="<%= c.email %>" required>
                    <input type="text" name="tel" value="<%= c.tel %>" required>
                    <input type="text" name="zone" value="<%= c.zone %>" required>
                    <input type="text" name="numVehicule" value="<%= c.numVehicule %>" required>
                    <button type="submit"><i class="fa-solid fa-save"></i> Enregistrer</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr><td colspan="8">Aucun collecteur trouv√©.</td></tr>
          <% } %>
        </tbody>
      </table>
    </section>

    <section>
      <h2><i class="fa-solid fa-user-plus"></i> Ajouter un Collecteur</h2>
      <form action="/api/agent/collecteurs" method="POST" class="add-form">
        <label>Nom :</label>
        <input type="text" name="nom" placeholder="Nom du collecteur" required>

        <label>Pr√©nom :</label>
        <input type="text" name="prenom" placeholder="Pr√©nom du collecteur" required>

        <label>Email :</label>
        <input type="email" name="email" placeholder="exemple@mail.com" required>

        <label>T√©l√©phone :</label>
        <input type="text" name="tel" placeholder="Num√©ro de t√©l√©phone" required>

        <label>Zone :</label>
        <input type="text" name="zone" placeholder="Ex : Borj Louzir" required>

        <label>Num√©ro de v√©hicule :</label>
        <input type="text" name="numVehicule" placeholder="Ex : TN-1234-AB" required>

        <button type="submit"><i class="fa-solid fa-plus"></i> Ajouter</button>
      </form>
    </section>
  </main>

  <script>
    function toggleUpdateForm(id) {
      const form = document.getElementById(`update-form-${id}`);
      form.style.display = form.style.display === "table-row" ? "none" : "table-row";
    }
  </script>
</body>
</html>
