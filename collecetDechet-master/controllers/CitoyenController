const CitoyenService = require('../services/CitoyenService');

class CitoyenController {
  // üåê Pages Web (EJS)
  static async pageDashboard(req, res) {
    try {
      const { citoyenId } = req.params;
      const data = await CitoyenService.getPointsEtDechets(citoyenId);
      res.render('Citoyen/dashboard', { citoyen: data, message: null });
    } catch (err) {
      res.status(500).send('Erreur serveur : ' + err.message);
    }
  }

  static async pageDechets(req, res) {
    try {
      const { citoyenId } = req.params;
      const data = await CitoyenService.getPointsEtDechets(citoyenId);
      res.render('Citoyen/dechets', { citoyen: data });
    } catch (err) {
      res.status(500).send('Erreur serveur : ' + err.message);
    }
  }

  static async depotDechetWeb(req, res) {
    try {
      const { citoyenId } = req.params;
      const { type, quantite, dateRencontre } = req.body;
      await CitoyenService.deposerDechet(citoyenId, type, quantite, dateRencontre);
      const data = await CitoyenService.getPointsEtDechets(citoyenId);
      res.render('Citoyen/dashboard', { citoyen: data, message: '‚úÖ D√©p√¥t effectu√© avec succ√®s !' });
    } catch (err) {
      res.status(500).send('Erreur serveur : ' + err.message);
    }
  }

  static async depotDechetAPI(req, res) {
    try {
      const { citoyenId } = req.params;
      const { type, quantite, dateRencontre } = req.body;
      const dechet = await CitoyenService.deposerDechet(citoyenId, type, quantite, dateRencontre);
      res.status(201).json(dechet);
    } catch (err) {
      res.status(500).json({ message: err.message });
    }
  }

  static async getDechetsAPI(req, res) {
    try {
      const { citoyenId } = req.params;
      const data = await CitoyenService.getPointsEtDechets(citoyenId);
      res.status(200).json(data);
    } catch (err) {
      res.status(500).json({ message: err.message });
    }
  }
}

module.exports = CitoyenController;
